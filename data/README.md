# Parkrun Data Scraping

This folder contains scripts to scrape detailed course information from parkrun course pages.

## Files

### Data Files
- **`silver_data.json`** - Silver level parkrun data (2,747 events worldwide)
- **`parkrun_detail.json`** - Detailed course information (generated by scraping)

### Scripts
- **`scrape_parkrun_details.py`** - Main scraper script
- **`test_scraper.py`** - Test script to verify scraping on sample events

## Quick Start

### 1. Test First (Recommended)
Run the test script on 5 sample events to verify everything works:

```bash
cd "c:\Users\deanw\Desktop\Wheelchair Racer\WheelchairRacer\data"
"C:/Program Files/Python313/python.exe" test_scraper.py
```

This will:
- Test scraping on Bushy parkrun (first ever parkrun)
- Test on 5 sample events
- Show you what the extracted data looks like
- Takes ~5-10 seconds

### 2. Run Full Scrape
If test results look good, run the full scraper:

```bash
"C:/Program Files/Python313/python.exe" scrape_parkrun_details.py
```

This will:
- Scrape all 2,747 parkrun course pages
- Extract descriptions (from h2, h3, p tags)
- Extract postcodes (from "getting there by road" sections)
- Generate `parkrun_detail.json`
- Takes ~45-50 minutes (1 second delay between requests)

## What Gets Scraped

### Description
- All text from `<h2>`, `<h3>`, and `<p>` tags
- Standalone text not in tags
- Cleaned and formatted as readable paragraphs

### Postcode
- Searches for UK postcodes in the "Getting there by road" section
- Format: `SW1A 1AA`, `EC1A 1BB`, etc.
- Falls back to searching entire page if section not found

## Output Format

`parkrun_detail.json` structure:

```json
{
  "metadata": {
    "version": "1.0",
    "created": "2025-10-17T...",
    "total_events": 2747,
    "scraping_summary": {
      "successful_scrapes": 2500,
      "postcodes_found": 800,
      "failed_scrapes": 247
    }
  },
  "events": [
    {
      "uid": 100,
      "name": "Bushy parkrun",
      "slug": "bushy",
      "coursePageUrl": "https://www.parkrun.org.uk/bushy/course",
      "description": "Full course description text...",
      "postcode": "TW11 0EQ",
      "scrapingStatus": "success",
      "scrapedAt": "2025-10-17T..."
    }
  ]
}
```

## Respectful Scraping

The scraper follows best practices:

‚úÖ **Rate Limiting**: 1 second delay between requests (3,600 requests/hour max)  
‚úÖ **User Agent**: Identifies as legitimate browser  
‚úÖ **Error Handling**: Gracefully handles failures  
‚úÖ **Timeout**: 10 second timeout per request  
‚úÖ **No Hammering**: Won't retry failed requests automatically  

**Estimated total time**: ~45-50 minutes for all 2,747 events

## Expected Results

Based on the silver data:
- **Total events**: 2,747
- **Expected success rate**: 90-95%
- **Expected postcodes**: 800-1,000 (mostly UK events)
- **Average description length**: 1,000-3,000 characters

## Troubleshooting

### Import errors
If you get `ModuleNotFoundError`, install dependencies:
```bash
pip install beautifulsoup4 requests lxml
```

### Connection errors
- Check internet connection
- Parkrun website might be down temporarily
- Try again later

### Low success rate
- Run test script first to verify
- Check if parkrun changed their HTML structure
- May need to update selectors in script

## Next Steps

After scraping:
1. ‚úÖ Review `parkrun_detail.json` to verify data quality
2. üîÑ Data cleaning (remove duplicates, fix formatting, etc.)
3. üìä Data analysis (identify patterns, categorize courses, etc.)
4. üóÑÔ∏è Load into database (Supabase)
5. üé® Build parkrun search/filter UI

## Notes

- **UK Postcodes Only**: Postcode extraction works for UK format only
- **Description Quality**: Varies by parkrun - some have detailed info, others minimal
- **International Events**: May have descriptions in local languages
- **Page Structure**: Script assumes standard parkrun page structure (as of Oct 2025)

## Script Configuration

Edit `scrape_parkrun_details.py` to adjust:

```python
RATE_LIMIT_DELAY = 1.0  # Seconds between requests (be respectful!)
REQUEST_TIMEOUT = 10    # Seconds before giving up on a request
```

**Don't reduce RATE_LIMIT_DELAY below 1.0** - be respectful to parkrun servers! ü§ù
